<!DOCTYPE html>
<html>

<head>
    <title>Push Notification</title>
</head>

<body>

    <button onclick="subscribe()"> Subscribe </button>
    <button onclick="unsubscribe()"> UnSubscribe </button>

    <script>

        addEventListener('load', async () => {
            register();
        });

        async function subscribe() {
            let sw = await navigator.serviceWorker.ready;
            let push = await sw.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: 'BDve_VdZQq36tdNR0BIbogIoxPEuHoDXCBPx13KMvv1mnuqP38uCScx5qGy-BsUj7ApJC9DWzuk_yY6wyy0_hLA'
            });
            console.log(JSON.stringify(push));
        }

        async function unsubscribe() {
            let sw = await navigator.serviceWorker.ready;
            sw.pushManager.getSubscription()
                .then(function (subscription) {
                    if (subscription) {
                        console.log("unsubscribe success");
                        return subscription.unsubscribe();
                    }
                })
                .catch(function (error) {
                    console.log('Error unsubscribing', error);
                }).then(function () {
                    unrigister();
                });
        }

        async function register() {
            let sw = await navigator.serviceWorker.register('./sw.js');
            console.log(sw);
        }

        async function unrigister() {
            let sw = await navigator.serviceWorker.ready;
            if (sw) {
                sw.unregister().then(function (flag) {
                    if (flag) {
                        console.log("unrigister success");
                    } else {
                        console.log("unrigister faild");
                    }
                });
            };
        }
    </script>
</body>

</html>