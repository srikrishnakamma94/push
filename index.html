<!DOCTYPE html>
<html>

<head>
    <title>Push Notification</title>
</head>

<body>

    <button onclick="subscribe()"> Subscribe </button>

    <script>
    
        addEventListener('load', async () => {
            register();
        });

        async function subscribe() {
            let sw = await navigator.serviceWorker.ready;
            let push = await sw.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: 'BDve_VdZQq36tdNR0BIbogIoxPEuHoDXCBPx13KMvv1mnuqP38uCScx5qGy-BsUj7ApJC9DWzuk_yY6wyy0_hLA'
            });
            console.log(JSON.stringify(push));
        }

        async function unsubscribe() {
            let sw = await navigator.serviceWorker.ready;
            let unsub = await sw.pushManager.unsubscribe().then(function (flag) {
                if (flag) {
                    console.log("unsubscribe success");
                    unrigister();
                } else {
                    console.log("unsubscribe faild");
                }
            });
        }

        async function register() {
            sw = await navigator.serviceWorker.register('./sw.js');
            console.log(sw);
        }

        async function unrigister() {
            if (sw) {
                sw.unregister().then(function (flag) {
                    if (flag) {
                        console.log("unrigister success");
                    } else {
                        console.log("unrigister faild");
                    }
                });
            };
        }
    </script>
</body>

</html>